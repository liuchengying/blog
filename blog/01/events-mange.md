## åŸºäºjsçš„äº‹ä»¶ç®¡ç†ï¼ˆè®¢é˜…-å‘å¸ƒï¼‰ --- events-manage

### å…³äºæ–‡ç« 

> æœ€è¿‘åœ¨æå‡ä¸ªäººæŠ€èƒ½çš„åŒæ—¶ï¼Œå†³å®šæŠŠè‡ªå·±ä¸ºæ•°ä¸å¤šçš„æ²‰æ·€è®°å½•ä¸‹æ¥ï¼Œè®©è‡ªå·±ç†è§£çš„æ›´åŠ æ·±åˆ»ï¼ŒåŒæ—¶ä¹Ÿæ¬¢è¿å„ä½çœ‹å®˜æŒ‡å‡ºä¸è¶³ä¹‹å¤„ã€‚

éšç€node.jsçš„ç››è¡Œï¼Œå¼•é¢†ç€Javascriptä¸Šå¤©ä¸‹åœ°æ— æ‰€ä¸èƒ½å•Šï¼Œæœ¬äººç¡®ç¡®å®å®çš„ä¸€ä¸ªå‰ç«¯çš„å¿ å®ç²‰ä¸ï¼Œäºæ˜¯ä¹......ä¸èƒ½è‡ªæ‹”...nodeçš„å¼‚æ­¥å›è°ƒæœºåˆ¶æœ‰æ•ˆçš„æé«˜äº†éå¯†é›†å‹ç¨‹åºçš„é«˜å¹¶å‘ã€é€Ÿåº¦å¿«ã€æ€§èƒ½ä¼˜çš„éœ€æ±‚åŒæ—¶ï¼Œä¹Ÿé¥±å—å„å¤§å‚å•†çš„é’çï¼Œæ­£æ˜¯nodeå°†javascriptåˆä¸€æ¬¡æ¨å‘äº†çƒ­æ½®ï¼Œäºæ˜¯å°ç™½åˆè¦åŸ‹å¤´è‹¦è¯»ï¼Œåœ¨å„ä½å¤§ç¥å’Œçœ‹å®˜æŒ‡å¼•çš„é“è·¯ä¸‹å‰è¿›ã€‚

è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå¾ˆæ—©å°±ä¸‹å®šå†³å¿ƒè¦è®°å½•å’Œåˆ†äº«ä¸€äº›è‡ªå·±å¯¹å·²æŒæ¡çš„çŸ¥è¯†çš„ä¸€äº›ç†è§£ï¼ˆå…¶å®çœŸå¿ƒè§‰å¾—å°†è‡ªå·±å­¦åˆ°ä¸œè¥¿ä»¥æ–‡ç« çš„å½¢å¼åˆ†äº«ç»™å¤§å®¶ï¼Œè¯é£é€šä¿—æ˜“æ‡‚ï¼Œä¸ä»…å·©å›ºäº†è‡ªå·±çš„çŸ¥è¯†ä½“ç³»ï¼Œè¿˜ä¼š æ¶¦ç‰©æ— å£°ï¼‰ï¼Œå¯è¿Ÿè¿Ÿæ²¡æœ‰å‹‡æ°”å’Œä¿¡å¿ƒã€‚

è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹è‡ªå·±å‰å‡ å¤©æ‰‹å†™çš„ä¸€ä¸ªå…¼å®¹nodeç¯å¢ƒã€æµè§ˆå™¨ç¯å¢ƒã€è¿˜æ”¯æŒVueçš„...åº“ã€‚**[event-mange](https://www.github.com/liuchengying/js-Events)**ï¼ˆ npmä»“åº“çš„åå­—ï¼‰ã€‚nodeä¸‹çš„EventEmitteræƒ³å¿…å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œåœ¨æ€è€ƒè¿‡åå†³å®šè‡ªå·±ä¹Ÿè¦äº§å‡ºä¸€ä¸ªç±»ä¼¼çš„äº‹ä»¶ç®¡ç†ï¼Œä¸ä»…èƒ½åœ¨nodeä¸‹ï¼Œè¿˜å¯ä»¥åœ¨æµè§ˆå™¨ç«¯ä»¥ <script> çš„æ–¹å¼å¼•å…¥ä½¿ç”¨ï¼Œè¿˜æœ‰CMDã€AMDä¸‹...äºæ˜¯ï¼Œæœ¬å°ç™½å¼€å§‹åŠ¨å·¥äº†ã€‚

### å…³äºäº‹ä»¶

> åœ¨æˆ‘ä»¬ä½¿ç”¨javascriptå¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ç”¨åˆ°å¾ˆå¤šäº‹ä»¶ï¼Œå¦‚ç‚¹å‡»ã€é”®ç›˜ã€é¼ æ ‡ç­‰ç­‰ï¼Œè¿™äº›ç‰©ç†æ€§çš„äº‹ä»¶ã€‚è€Œæˆ‘ä»¬ä»Šå¤©æ‰€è¯´çš„æˆ‘ç§°ä¹‹ä¸ºäº‹ä»¶çš„ï¼Œæ˜¯å¦ä¸€ç§å½¢å¼çš„äº‹ä»¶ï¼Œè®¢é˜…---å‘å¸ƒï¼Œåˆå«åšè§‚å¯Ÿè€…æ¨¡å¼ï¼Œä»–å®šä¹‰äº†ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè€Œåœ¨javascriptä¸­ï¼Œä¸€èˆ¬ä¹ æƒ¯æ€§çš„ç”¨äº‹ä»¶æ¨¡å‹æ¥æ›¿ä»£å‘å¸ƒ---è®¢é˜…æ¨¡å¼ã€‚

åˆ—ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥å¸®åŠ©å¤§å®¶ç†è§£è¿™ä¸€ç§æ¨¡å¼ã€‚ç‚çƒ­çš„å¤å¤©ï¼Œå¦ˆå¦ˆçƒ§å¥½äº†é¥­ç››ä¸Šæ¡Œï¼Œå†’ç€çƒ­æ°”ï¼Œè¿™æ—¶å¦ˆå¦ˆå–Šå°æ˜åƒé¥­ï¼ˆå°æ˜åœ¨æ—è¾¹çš„å±‹å­é‡Œé¥¿ç€è‚šå­å¤§å‰å¤§åˆ©æ™šä¸Šåƒé¸¡...ï¼‰ï¼Œå°æ˜å‡ºæ¥ä¸€çœ‹ï¼Œè·Ÿå¦ˆå¦ˆè¯´ï¼Œç­‰ä¸€ä¼š â€˜é¥­å‡‰äº†â€™ å†å«æˆ‘ï¼Œå¤ªçƒ«äº†...ååˆ†é’Ÿå...å¦ˆå¦ˆå–Šä½  â€˜é¥­å‡‰äº†â€™ï¼Œå¿«æ¥åƒé¥­ï¼Œè€Œè¿™æ—¶å°æ˜å¬åˆ°äº†å¦ˆå¦ˆçš„å–Šè¯è¯´ â€˜é¥­å‡‰äº†â€™ï¼Œä¾¿å¿«é€Ÿçš„å‡ºæ¥åƒå®Œäº†ã€‚è¿™ä¸ªä¾‹å­ï¼Œå°±æ˜¯ä»¥ä¸Šä»‹ç»çš„è®¢é˜…---å‘å¸ƒæ¨¡å¼ã€‚ä¾‹å­ä¸­çš„å°æ˜å°±æ˜¯è®¢é˜…è€…ï¼ˆè®¢é˜…çš„æ˜¯ â€˜é¥­å‡‰äº†â€™ï¼‰ï¼Œè€Œå¦ˆå¦ˆåˆ™æ˜¯å‘å¸ƒè€…ï¼ˆå°†ä¿¡å· â€˜é¥­å‡‰äº†â€™ å‘å¸ƒå‡ºå»ï¼‰ã€‚

ä½¿ç”¨è®¢é˜…---å‘å¸ƒæ¨¡å¼çš„æœ‰ç€æ˜¾è€Œæ˜“è§çš„ä¼˜ç‚¹ï¼šè®¢é˜…è€…ä¸ç”¨æ¯æ—¶æ¯åˆ»éƒ½è¯¢é—®å‘å¸ƒè€…é¥­æ˜¯å¦å‡‰äº†ï¼Œåœ¨åˆé€‚çš„äº‹ä»¶ç‚¹ï¼Œå‘å¸ƒè€…ä¼šé€šçŸ¥è¿™äº›è®¢é˜…è€…ï¼Œå‘Šè¯‰ä»–ä»¬é¥­å‡‰äº†ï¼Œä»–ä»¬å¯ä»¥è¿‡æ¥åƒäº†ã€‚è¿™æ ·å°±ä¸ç”¨æŠŠå°æ˜å’Œå¦ˆå¦ˆå¼ºè€¦åˆåœ¨ä¸€èµ·ï¼Œå½“å°æ˜çš„å¼Ÿå¼Ÿå¦¹å¦¹éƒ½æƒ³åœ¨é¥­å‡‰äº†åœ¨åƒé¥­ï¼Œåªéœ€å‘Šè¯‰å¦ˆå¦ˆä¸€å£°ã€‚å°±åƒæ¯ä¸ªçœ‹å®˜è‚¯å®šéƒ½æ¥è§¦è¿‡çš„ä¸€ç§è®¢é˜…---å‘å¸ƒï¼šDOMäº‹ä»¶çš„ç»‘å®š

``` javascript
document.body.addEventListener('click', function (e) {
     console.log('æˆ‘æ‰§è¡Œäº†...')
}, false)
```

#### å›å½’æ­£é¢˜ï¼š

> ##### ****[event-mange](https://www.github.com/liuchengying/js-Events)**  é€šè¿‡è®¢é˜…-å‘å¸ƒæ¨¡å¼å®ç°çš„**

### ä¸€æ­¥ä¸€æ­¥çš„å®ç°
**[event-mange](https://www.github.com/liuchengying/js-Events)** æ¨¡å—çš„ä¸»è¦**æ–¹æ³•**ï¼š

* onï¼šè®¢é˜…è€…ï¼Œæ·»åŠ äº‹ä»¶
* emitï¼šå‘å¸ƒè€…ï¼Œ å‡ºå‘äº‹ä»¶
* onceï¼š è®¢é˜…è€…ï¼Œæ·»åŠ åªèƒ½ç›‘å¬ä¸€æ¬¡ä¹‹åå°±å¤±æ•ˆçš„äº‹ä»¶
* removeListenerï¼šåˆ é™¤å•ä¸ªè®¢é˜…ï¼ˆäº‹ä»¶ï¼‰
* removeAllListenerï¼š åˆ é™¤å•ä¸ªäº‹ä»¶ç±»å‹çš„è®¢é˜…æˆ–åˆ é™¤å…¨éƒ¨è®¢é˜…
* getListenerCountï¼šè·å¾—è®¢é˜…è€…çš„æ•°é‡
  
**[event-mange](https://www.github.com/liuchengying/js-Events)** æ¨¡å—çš„ä¸»è¦**å±æ€§**ï¼š
* MaxEventListNum: è®¾ç½®å•ä¸ªäº‹ä»¶æœ€å¤šè®¢é˜…è€…æ•°é‡ï¼ˆé»˜è®¤ä¸º10ï¼‰

---------
##### åŸºæœ¬éª¨æ¶

é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ event.on , event.emit æ¥è®¢é˜…å’Œå‘å¸ƒï¼Œé€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªeventå®ä¾‹ï¼Œè€Œonï¼Œemitåˆ†åˆ«ä¸ºè¿™ä¸ªå®ä¾‹çš„ä¸¤ä¸ªæ–¹æ³•, åŒæ ·çš„ï¼Œä»¥ä¸Šåˆ—å‡ºçš„æ‰€æœ‰ä¸»è¦æ–¹æ³•ï¼Œéƒ½æ˜¯eventçš„å¯¹è±¡çš„åŸå‹æ–¹æ³•ã€‚
``` javascript
function events () {};

// åˆ—ä¸¾å»æˆ‘ä»¬æƒ³è¦å®ç°çš„eventå¯¹è±¡çš„æ–¹æ³•

event.prototype.on = function () {};

event.prototype.emit = function () {};

event.prototype.once = function () {};

event.prototype.removeListener = function () {};

event.prototype.removeAllListener = function () {};

event.prototype.getListenerCount = function () {};
```
ä¼¼ä¹ä¸¢äº†ä»€ä¹ˆï¼Œæ²¡é”™ï¼Œæ˜¯eventå¯¹è±¡æˆ‘ä»¬ä¸Šé¢åˆ—å‡ºæ¥çš„MaxEventListNumå±æ€§ï¼Œæˆ‘ä»¬ç»™ä»–è¡¥ä¸Š
``` javascript
function event () {
    //å› ä¸ºMaxEventListNumå±æ€§æ˜¯å¯ä»¥è®©å¼€å‘è€…è®¾ç½®çš„
    //æ‰€ä»¥åœ¨æ²¡æœ‰setçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º undefind
    this.MaxEventListNum = this.MaxEventListNum || undefined;

    //å¦‚æœæ²¡æœ‰è®¾ç½®setï¼Œæˆ‘ä»¬ä¸èƒ½è®©ç›‘å¬æ•°é‡æ— é™å¤§
    //è¿™æ ·æœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æº¢å‡º
    //æ‰€ä»¥æˆ‘ä»¬å°†é»˜è®¤æ•°é‡è®¾ç½®ä¸º10ï¼ˆå½“ç„¶ï¼Œè®¾ç½®æˆåˆ«çš„æ•°é‡ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰
    this.defaultMaxEventListNum = 10;
}

```
åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬æƒ³å®ç°çš„æ—¶é—´ç®¡ç†æ¨¡å—å±æ€§å’Œæ–¹æ³•çš„åˆæ€ä¹Ÿå°±å·®ä¸å¤šäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéª¨æ¶å‡ºæ¥äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦å¡«é¥±ä»–çš„ä»£ç é€»è¾‘ï¼Œè®©ä»–å˜çš„æœ‰è¡€æœ‰è‚‰ï¼ˆçœ‹ä¼¼åƒä¸ªç”Ÿå‘½...ï¼‰

å€¼å¾—æ€è€ƒçš„æ˜¯ï¼Œéª¨æ¶æˆ‘ä»¬æ„å»ºå®Œäº†ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ä¸€ä¸ªè®¢é˜…--å‘å¸ƒæ¨¡å¼ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»è®°ä½ä¼—å¤šçš„è®¢é˜…äº‹ä»¶å‘¢ï¼Ÿ é¦–å…ˆï¼Œå¯¹äºä¸€ä¸ªè®¢é˜…ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªè®¢é˜…çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯topicï¼Œé’ˆå¯¹æ­¤topicæˆ‘ä»¬è¦æŠŠæ‰€æœ‰çš„è®¢é˜…æ­¤topicçš„äº‹ä»¶éƒ½æ”¾åœ¨ä¸€èµ·ï¼Œå¯¹ï¼Œå¯ä»¥é€‰æ‹©Arrayï¼Œåˆæ­¥çš„æ„é€ 

``` javascript
event_list: {
    topic1: [fn1, fn2, fn3 ...]
    ...
}
```

é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°†å­˜æ”¾æˆ‘ä»¬äº‹ä»¶çš„event_listæ”¾å…¥ä»£ç ä¸­å®Œå–„,ä½œä¸ºeventçš„å±æ€§

``` javascript
function event () {
    // è¿™é‡Œæˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„åˆ¤æ–­ï¼Œä»¥å…ä¸€äº›æ„å¤–çš„é”™è¯¯å‡ºç°
    if(!this.event_list) {
        this.event_list = {};
    }

    this.MaxEventListNum = this.MaxEventListNum || undefined;
    this.defaultMaxEventListNum = 10;
}
```
----------
##### on æ–¹æ³•å®ç°

``` javascript
event.prototype.on = function () {};
```
é€šè¿‡åˆ†æå¾—å‡ºonæ–¹æ³•é¦–å…ˆåº”è¯¥æ¥æ”¶ä¸€ä¸ªè®¢é˜…çš„topicï¼Œå…¶æ¬¡æ˜¯ä¸€ä¸ªå½“æ­¤topicå“åº”åè§¦å‘çš„callbackæ–¹æ³•

``` javascript
event.prototype.on = function (eventName, content) {};
```
eventNameä½œä¸ºäº‹ä»¶ç±»å‹ï¼Œå°†å…¶ä½œä¸ºevent_listçš„ä¸€ä¸ªå±æ€§ï¼Œæ‰€æœ‰çš„äº‹ä»¶ç±»å‹ä¸ºeventNameçš„ç›‘å¬éƒ½pushåˆ°eventNameè¿™ä¸ªæ•°ç»„é‡Œé¢ã€‚
``` javascript
event.prototype.on = function (eventName, content) {
    ...
    var _event, ctx;
    _event = this.event_list;
    // å†æ¬¡åˆ¤æ–­event_listæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™é‡æ–°èµ‹å€¼
    if (!_event) {
      _event = this.event_list = {};
    } else {
      // è·å–å½“å‰eventNameçš„ç›‘å¬
      ctx = this.event_list[eventName];
    }
    // åˆ¤æ–­æ˜¯å¦æœ‰æ­¤ç›‘å¬ç±»å‹
    // å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºæ­¤äº‹ä»¶ç¬¬ä¸€æ¬¡è¢«ç›‘å¬
    // å°†å›è°ƒå‡½æ•° content ç›´æ¥èµ‹å€¼
    if (!ctx) {
      ctx = this.event_list[eventName] = content;
      // æ”¹å˜è®¢é˜…è€…æ•°é‡
      ctx.ListenerCount = 1;
    } else if (isFunction(ctx)) {
      // åˆ¤æ–­æ­¤å±æ€§æ˜¯å¦ä¸ºå‡½æ•°ï¼ˆæ˜¯å‡½æ•°åˆ™è¡¨ç¤ºå·²ç»æœ‰ä¸”åªæœ‰ä¸€ä¸ªè®¢é˜…è€…ï¼‰
      // å°†æ­¤eventNameç±»å‹ç”±å‡½æ•°è½¬å˜ä¸ºæ•°ç»„
      ctx = this.event_list[eventName] = [ctx, content];
      // æ­¤æ—¶è®¢é˜…è€…æ•°é‡å˜ä¸ºæ•°ç»„é•¿åº¦
      ctx.ListenerCount = ctx.length;
    } else if (isArray(ctx)) {
      // åˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ï¼Œå¦‚æœæ˜¯æ•°ç»„åˆ™ç›´æ¥push
      ctx.push(content);
      ctx.ListenerCount = ctx.length;
    }
    ...
};
```

##### once æ–¹æ³•å®ç°
``` javascript
event.prototype.once = function () {};
```
onceæ–¹æ³•å¯¹å·²è®¢é˜…äº‹ä»¶åªæ‰§è¡Œä¸€æ¬¡ï¼Œéœ€æ‰§è¡Œå®Œåç«‹å³åœ¨event_listä¸­ç›¸åº”çš„è®¢é˜…ç±»å‹å±æ€§ä¸­åˆ é™¤è¯¥è®¢é˜…çš„å›è°ƒå‡½æ•°ï¼Œå…¶å­˜å‚¨è¿‡ç¨‹ä¸onæ–¹æ³•å‡ ä¹ä¸€è‡´ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªè®¢é˜…ç±»å‹çš„topicï¼Œä»¥åŠä¸€ä¸ªå“åº”äº‹ä»¶çš„å›è°ƒ content
``` javascript
event.prototype.once = function (eventName, content) {};
```
åœ¨æ‰§è¡Œå®Œæœ¬æ¬¡äº‹ä»¶å›è°ƒåç«‹å³å–æ¶ˆæ³¨å†Œæ­¤è®¢é˜…ï¼Œè€Œå¦‚æœæ­¤æ—¶åŒä¸€ç±»å‹çš„äº‹ä»¶æ³¨å†Œäº†å¤šä¸ªç›‘å¬å›è°ƒï¼Œæˆ‘ä»¬æ— æ³•å‡†ç¡®çš„åˆ é™¤å½“å‰onceæ–¹æ³•æ‰€æ³¨å†Œçš„ç›‘å¬å›è°ƒï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬é‡‡ç”¨çš„éå†äº‹ä»¶ç›‘å¬é˜Ÿåˆ—ï¼Œæ‰¾åˆ°ç›¸åº”çš„ç›‘å¬å›è°ƒç„¶åå°†å…¶åˆ é™¤æ˜¯è¡Œä¸é€šçš„ã€‚è¿˜å¥½ï¼Œä¼Ÿå¤§çš„javascriptè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„é—­åŒ…ç‰¹æ€§ï¼Œé€šè¿‡é—­åŒ…çš„æ–¹å¼æ¥è£…é¥°contentï¼ŒåŒ…è£…æˆä¸€ä¸ªå…¨æ–°çš„å‡½æ•°ã€‚
``` javascript
events.prototype.once = function (event, content) {
    ...
    // onceå’Œonçš„å­˜å‚¨äº‹ä»¶å›è°ƒæœºåˆ¶ç›¸åŒ
    // dealOnce å‡½æ•° åŒ…è£…å‡½æ•°
    this.on(event, dealOnce(this, event, content));
    ...
  }

// åŒ…è£…å‡½æ•°
function dealOnce(target, type, content) {
    var flag = false;
    // é€šè¿‡é—­åŒ…ç‰¹æ€§ï¼ˆä¼šå°†å‡½æ•°å¤–éƒ¨å¼•ç”¨ä¿å­˜åœ¨ä½œç”¨åŸŸä¸­ï¼‰
    function packageFun() {
      // å½“æ­¤ç›‘å¬å›è°ƒè¢«è°ƒç”¨æ—¶ï¼Œä¼šå…ˆåˆ é™¤æ­¤å›è°ƒæ–¹æ³•
      this.removeListener(type, packageFun);
      if (!flag) {
        flag = true;
        // å› ä¸ºé—­åŒ…ï¼Œæ‰€ä»¥åŸç›‘å¬å›è°ƒè¿˜ä¼šä¿ç•™ï¼Œæ‰€ä»¥è¿˜ä¼šæ‰§è¡Œ
        content.apply(target, arguments);
      }
      packageFun.content = content;
    }
    return packageFun;
  }
```
onceçš„å®ç°å…¶å®å°†æˆ‘ä»¬è‡ªå·±ä¼ é€’çš„å›è°ƒå‡½æ•°åšäº†äºŒæ¬¡å°è£…ï¼Œå†ç»‘å®šä¸Šå°è£…åçš„å‡½æ•°ï¼Œå°è£…çš„å‡½æ•°é¦–å…ˆæ‰§è¡Œäº†removeListener()ç§»é™¤äº†å›è°ƒå‡½æ•°ä¸äº‹ä»¶çš„ç»‘å®šï¼Œç„¶åæ‰æ‰§è¡Œçš„å›è°ƒå‡½æ•°

##### emit æ–¹æ³•å®ç°
``` javascript
event.prototype.emit = function () {};
```
emitæ–¹æ³•ç”¨æ¥å‘å¸ƒäº‹ä»¶ï¼Œé©±åŠ¨æ‰§è¡Œç›¸åº”çš„äº‹ä»¶ç›‘å¬é˜Ÿåˆ—ä¸­çš„ç›‘å¬å›è°ƒï¼Œæ•…æˆ‘ä»¬éœ€è¦ä¸€ä¸ªäº‹ä»¶typeçš„topic
``` javascript
event.prototype.emit = function (eventName[,message][,message1][,...]) {};
```

å½“ç„¶ï¼Œå‘å¸ƒäº‹ä»¶æ˜¯ï¼Œä¹Ÿå¯ä»¥åƒè¯¥äº‹ä»¶ç›‘å¬è€…ä¼ é€’å‚æ•°,æ•°é‡ä¸é™ï¼Œåˆ™ä¼šä¾æ¬¡ä¼ é€’ç»™æ‰€æœ‰çš„ç›‘å¬å›è°ƒ

``` javascript
event.prototype.emit = function (eventName[,message]) {
    var _event, ctx;
    //é™¤ç¬¬ä¸€ä¸ªå‚æ•°eventNmaeå¤–ï¼Œå…¶ä»–å‚æ•°ä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„é‡Œ
    var args = Array.prototype.slice.call(arguments, 1);
    _event = this.event_list;
    // æ£€æµ‹å­˜å‚¨äº‹ä»¶é˜Ÿåˆ—æ˜¯å¦å­˜åœ¨
    if (_event) {
      // å¦‚æœå­˜åœ¨ï¼Œå¾—åˆ°æ­¤ç›‘å¬ç±»å‹
      ctx = this.event_list[eventName];
    }
    // æ£€æµ‹æ­¤ç›‘å¬ç±»å‹çš„äº‹ä»¶é˜Ÿåˆ—
    // ä¸å­˜åœ¨åˆ™ç›´æ¥è¿”å›
    if (!ctx) {
      return false;
    } else if (isFunction(ctx)) {
      // æ˜¯ç•ªè–¯åˆ™ç›´æ¥æ‰§è¡Œï¼Œå¹¶å°†æ‰€æœ‰å‚æ•°ä¼ é€’ç»™æ­¤å‡½æ•°ï¼ˆå›è°ƒå‡½æ•°ï¼‰
      ctx.apply(this, args);
    } else if (isArray(ctx)) {
      // æ˜¯æ•°ç»„åˆ™éå†è°ƒç”¨
      for (var i = 0; i < ctx.length; i++) {
        ctx[i].apply(this, args);
      }
    }
};
```

emitä»ç†è§£ç¨‹åº¦ä¸Šæ¥è¯´åº”è¯¥æ˜¯æ›´å®¹æ˜“ä¸€äº›ï¼Œåªæ˜¯ä»å­˜å‚¨äº‹ä»¶çš„å¯¹è±¡ä¸­æ‰¾åˆ°ç›¸åº”ç±»å‹çš„ç›‘å¬äº‹ä»¶é˜Ÿåˆ—ï¼Œç„¶åæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªå›è°ƒ

##### removeListener æ–¹æ³•å®ç°
``` javascript
event.prototype.removeListener = function () {};
```
åˆ é™¤æŸç§ç›‘å¬ç±»å‹çš„æŸä¸€ä¸ªç›‘å¬å›è°ƒï¼Œæ˜¾ç„¶ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªäº‹ä»¶typeï¼Œä»¥åŠä¸€ä¸ªç›‘å¬å›è°ƒï¼Œå½“äº‹ä»¶å¯¹åˆ—ä¸­çš„å›è°ƒä¸è¯¥å›è°ƒç›¸åŒæ—¶ï¼Œåˆ™ç§»é™¤
``` javascript
event.prototype.removeListener = function (eventName, content) {};
```
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç¡®å®å­˜åœ¨è¦ç§»é™¤æŸä¸ªç›‘å¬äº‹ä»¶çš„å›è°ƒï¼Œåœ¨onæ–¹æ³•æ—¶ä¸€å®šä¸è¦ä½¿ç”¨åŒ¿åå‡½æ•°ä½œä¸ºå›è°ƒï¼Œè¿™æ ·ä¼šå¯¼è‡´åœ¨removeListeneræ˜¯æ— æ³•ç§»é™¤ï¼Œå› ä¸ºåœ¨javascriptä¸­åŒ¿åå‡½æ•°æ˜¯ä¸ç›¸ç­‰çš„ã€‚
``` javascript
// å¦‚æœéœ€è¦ç§»é™¤

// é”™è¯¯
event.on('eatting', function (msg) {

});

// æ­£ç¡®
event.on('eatting', cb);
// å›è°ƒ
function cb (msg) {
    ...
}
```
``` javascript
event.prototype.removeListener = function (eventName, content) {
    var _event, ctx, index = 0;
    _event = this.event_list;
    if (!_event) {
      return this;
    } else {
      ctx = this.event_list[eventName];
    }
    if (!ctx) {
      return this;
    }
    // å¦‚æœæ˜¯å‡½æ•°  ç›´æ¥delete
    if (isFunction(ctx)) {
      if (ctx === content) {
        delete _event[eventName];
      }
    } else if (isArray(ctx)) {
      // å¦‚æœæ˜¯æ•°ç»„ éå†
      for (var i = 0; i < ctx.length; i++) {
        if (ctx[i] === content) {
          // ç›‘å¬å›è°ƒç›¸ç­‰
          // ä»è¯¥ç›‘å¬å›è°ƒçš„indexå¼€å§‹ï¼Œåé¢çš„å›è°ƒä¾æ¬¡è¦†ç›–æ‰å‰é¢çš„å›è°ƒ
          // å°†æœ€åçš„å›è°ƒåˆ é™¤
          // ç­‰ä»·äºç›´æ¥å°†æ»¡è¶³æ¡ä»¶çš„ç›‘å¬å›è°ƒåˆ é™¤
          this.event_list[eventName].splice(i - index, 1);
          ctx.ListenerCount = ctx.length;
          if (this.event_list[eventName].length === 0) {
            delete this.event_list[eventName]
          }
          index++;
        }
      }
    }
};

```
##### removeAllListener æ–¹æ³•å®ç°
``` javascript
event.prototype.removeAllListener = function () {};
```
æ­¤æ–¹æ³•æœ‰ä¸¤ä¸ªç”¨é€”ï¼Œå³å®ç°å½“æœ‰å‚æ•°äº‹ä»¶ç±»å‹eventNameæ—¶ï¼Œåˆ™åˆ é™¤è¯¥ç±»å‹çš„æ‰€æœ‰ç›‘å¬ï¼ˆæ¸…ç©ºæ­¤äº‹ä»¶çš„ç›‘å¬å›è°ƒé˜Ÿåˆ—ï¼‰ï¼Œå½“æ²¡æœ‰å‚æ•°æ—¶ï¼Œåˆ™å°†æ‰€æœ‰ç±»å‹çš„äº‹ä»¶ç›‘å¬å¯¹å’å…¨éƒ¨ç§»é™¤ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ç›´æ¥ä¸Šä»£ç 
``` javascript
event.prototype.removeAllListener = function ([,eventName]) {
    var _event, ctx;
    _event = this.event_list;
    if (!_event) {
      return this;
    }
    ctx = this.event_list[eventName];
    // åˆ¤æ–­æ˜¯å¦æœ‰å‚æ•°
    if (arguments.length === 0 && (!eventName)) {
      // æ— å‚æ•°
      // å°†key è½¬æˆ æ•°ç»„  å¹¶éå†
      // ä¾æ¬¡åˆ é™¤æ‰€æœ‰çš„ç±»å‹ç›‘å¬
      var keys = Object.keys(this.event_list);
      for (var i = 0, key; i < keys.length; i++) {
        key = keys[i];
        delete this.event_list[key];
      }
    }
    // æœ‰å‚æ•° ç›´æ¥ç§»é™¤
    if (ctx || isFunction(ctx) || isArray(ctx)) {
      delete this.event_list[eventName];
    } else {
      return this;
    }
};
```
å…¶ä¸»è¦å®ç°æ€è·¯å¤§è‡´å¦‚ä¸Šæ‰€è¿°ï¼Œè²Œä¼¼è¿˜æ¼äº†ä¸€äº›ä»€ä¹ˆï¼Œå“¦ï¼Œæ˜¯å¯¹äºæ˜¯å¦è¶…è¿‡èˆ°è‰‡æ•°é‡çš„æœ€å¤§é™åˆ¶çš„å¤„ç†
åœ¨onæ–¹æ³•ä¸­
``` javascript
...
// æ£€æµ‹å›è°ƒé˜Ÿåˆ—æ˜¯å¦æœ‰maxedå±æ€§ä»¥åŠæ˜¯å¦ä¸ºfalse
if (!ctx.maxed) {
      //åªæœ‰åœ¨æ˜¯æ•°ç»„çš„æƒ…å†µä¸‹æ‰ä¼šåšæ¯”è¾ƒ
      if (isArray(ctx)) {
        var len = ctx.length;
        if (len > (this.MaxEventListNum ? this.MaxEventListNum : this.defaultMaxEventListNum)) { 
        // å½“è¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œåˆ™ä¼šå‘é™¤è­¦å‘Š
          ctx.maxed = true;
          console.warn('events.MaxEventListNum || [ MaxEventListNum ] :The number of subscriptions exceeds the maximum, and if you do not set it, the default value is 10');
        } else {
          ctx.maxed = false;
        }
      }
    }

...
```
-------------

ç°åœ¨Vueå¯è°“æ˜¯çº¢çš„å‘ç´«ï¼Œæ²¡å…³ç³»ï¼Œevents-manageä¹Ÿå¯ä»¥åœ¨Vueä¸­æŒ‚åœ¨åˆ°å…¨å±€ä½¿ç”¨å“¦

``` javascript
events.prototype.install = function (Vue, Option) {
    Vue.prototype.$ev = this;
  }
```
ä¸ç”¨å¤šè§£é‡Šäº†å§ï¼Œæƒ³å¿…çœ‹å®˜éƒ½æ˜ç™½åº”è¯¥æ€ä¹ˆä½¿ç”¨äº†å§(åœ¨Vueä¸­)

##### å…³äºæœ¬åº“æ›´å…·ä½“æ›´è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼Œ[èµ¶ç´§æˆ³è¿™é‡Œ](https://www.github.com/liuchengying/js-Events)

ç å­—ä¸æ˜“å•Šï¼Œå¦‚æœè§‰å¾—å¯¹æ‚¨æœ‰ä¸€äº›å¸®åŠ©ï¼Œè¿˜è¯·ç»™ä¸€ä¸ªå¤§å¤§çš„èµğŸ‘å“ˆå“ˆ

ï¼ˆ...å·²æ˜¯å‡Œæ™¨...ï¼‰

