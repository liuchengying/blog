## æ‰“å¼€å°ç¨‹åºçš„å¤§é—¨---ä¸€æ¬¾å¤©æ°”å°ç¨‹åºçš„è¯ç”Ÿ(èœ—ç‰›å°å¤©æ°”)

> â€”â€”â€”â€” æ¶¦ç‰©æ— å£°ï¼Œåšä¸€ä¸ªæœ‰ä¸ªæ ¼è°ƒçš„coder

> **å°ç¨‹åºã€å¿«åº”ç”¨**ç°åœ¨å¯è°“æ˜¯å®¶å–»æˆ·æ™“ï¼Œä¹Ÿæ›´åŠ å¯†åˆ‡çš„æ¸—é€å…¥æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­ï¼Œç¬”è€…ä¹Ÿç®—æ˜¯ä¸ªçˆ±æŠ˜è…¾çš„äººï¼Œä¿—è¯è¯´çš„å¥½å˜›ï¼Œâ€œä¸æŠ˜è…¾ï¼Œä¸å‰ç«¯â€œï¼ˆå½“ç„¶æ˜¯ç¬”è€…è‡ªå·±çš„å°å¿ƒå£°ï¼‰ã€‚äºæ˜¯åœ¨å¹³æ—¥é‡Œå¿™ç¢Œçš„å·¥ä½œä¹‹ä½™æŠ½å‡ºæ¥æ—¶é—´æç‚¹äº‹(si)æƒ…,æ¥å†™ä¸€ä¸ªå±äºè‡ªå·±çš„è´´èº«å°å¤©æ°”ã€‚è¯´æ—¶è¿Ÿé‚£æ—¶å¿«ï¼Œè¿™å°±æ¥äº†...

ç»è¿‡ä¸¤ä¸‰å¹´çš„å‘å±•ï¼Œå°ç¨‹åºçš„åœ°ä½ä¹Ÿæ­¥æ­¥é«˜å‡ï¼Œç”±è…¾è®¯é¢†é˜Ÿçš„è…¾è®¯å°ç¨‹åºï¼Œå†åˆ°åæ¥çš„æ”¯ä»˜å®ï¼Œç¾å›¢ï¼Œå¤´æ¡ç­‰ä¹Ÿéƒ½ç›¸åº”æ¨å‡ºè‡ªå®¶çš„å°ç¨‹åºå¹³å°ï¼Œéƒ½æƒ³é¡ºç€æ½®æµæŠ“ä½æµé‡åˆ†ä¸€æ¯ç¾¹ï¼Œå¯è°“æ˜¯å…µå®¶å¿…äº‰ä¹‹åœ°ã€‚å¤§ç¯å¢ƒçš„æ”¹å˜ï¼Œä¸ºäº†æé«˜å°ç¨‹åºçš„å¿«é€Ÿè¿­ä»£å’Œå¤šäººåˆä½œå¼€å‘çš„æ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„å¤§å‚å•†éƒ½å¼€æºäº†è‡ªå·±çš„å°ç¨‹åºæ¡†æ¶ï¼Œ[mpvue](https://github.com/Meituan-Dianping/mpvue)ã€[wepy](https://tencent.github.io/wepy)ã€[MINA](https://developers.weixin.qq.com/miniprogram/dev/framework/MINA.html)ã€[Taro](http://taro.aotu.io/)ç­‰ç›¸ä¿¡å¤§å®¶ä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰äº†ã€‚è€Œå°ç¨‹åºçš„ç¤¾åŒºä¹Ÿå˜å¾—è·Ÿä¸°å¯Œå¥å£®ï¼Œä¹Ÿè¡ç”Ÿå‡ºå¾ˆå¤šç²¾ç¾çš„UIæ¡†æ¶ã€‚æœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œå»ç›¸åº”çš„å®˜ç½‘äº†è§£è¯¦æƒ…ã€‚

è™½ç„¶ä¸Šé¢ä»‹ç»äº†é‚£ä¹ˆå¤šçš„æ¡†æ¶ï¼Œè€Œæœ¬æ¬¡ç¬”è€…å¹¶æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ï¼Œè€Œæ˜¯ç”¨åŸç”Ÿçš„å°ç¨‹åºæ¥å¼€å‘ä»Šå¤©çš„ä¸»è§’ï¼Œä¹Ÿå¸Œæœ›èƒ½å¤Ÿç”¨åŸå§‹çš„æ–¹å¼æ¥ç»™é‚£äº›å’Œç¬”è€…ä¸€æ ·çš„åˆšåˆšå…¥é—¨çš„å°ç¨‹åºå¼€å‘è€…ä¸€äº›å¸®åŠ©ï¼Œä¹Ÿå°†è‡ªå·±æ‰€å­¦çš„è®°å½•ä¸‹æ¥ã€‚æ¯•ç«ŸåŸç”Ÿæ‰æ˜¯æœ€åº•å±‚çš„åŸºç¡€ï¼Œæ‰€æœ‰çš„æ¡†æ¶éƒ½æ˜¯åœ¨åŸç”Ÿçš„åŸºç¡€ä¸Šå¼€èŠ±ç»“æœçš„ï¼Œè¿™æ ·æ‰èƒ½ä»¥ä¸å˜åº”ä¸‡å˜(å¼å¼~)ã€‚ç¬”è€…æ°´å¹³æœ‰é™ï¼Œæœ‰é”™è¯¯æˆ–è€…è§£é‡Šä¸å½“çš„åœ°æ–¹è¿˜æœ›å„ä½çœ‹å®˜å¤šå¤šåŒ…æ¶µã€‚

## èœ—ç‰›å°å¤©æ°”  æ•ˆæœå›¾
**é¡¹ç›®æºç ** [æ¶¦ç‰©æ— å£°github](https://github.com/liuchengying/wxWeather)
![é¢„è§ˆå›¾](./img/gif.GIF)
![é¢„è§ˆå›¾1](./img/4.png)

## æ¦‚å†µ
![äºŒç»´ç ](./img/xiaochengxu.jpg)

åœ¨å®šä½åŠŸèƒ½ä¸­ï¼Œæœ¬ç¨‹åºç”¨åˆ°**è…¾è®¯åœ°å›¾**çš„api
ç›¸åº”çš„å¤©æ°”æ¥å£ä¸­ï¼Œæœ¬ç¨‹åºç”¨åˆ°çš„æ˜¯**å’Œé£å¤©æ°”**æä¾›çš„api
> ä¸¤è€…éƒ½éœ€è¦åˆ°å®˜ç½‘ä¸­æ³¨å†Œå¼€å‘è€…è´¦å·ï¼Œé€šè¿‡æ³¨å†Œåå¾—åˆ°çš„appKeyæ¥è¯·æ±‚æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œè¯¦ç»†æ³¨å†Œæ­¥éª¤è¯·è‡ªè¡Œåº¦å¨˜
> 
ç”±äºéœ€è¦ç”¨åˆ°å®šä½åŠŸèƒ½ï¼Œè€Œå°ç¨‹åºæœ¬èº«çš„getLocationæ–¹æ³•è·å–åˆ°çš„æ˜¯å½“å‰ä½ç½®çš„åæ ‡ï¼š
``` javascript
    wx.getLocation({
      type: 'gcj02', // è¿”å›åæ ‡çš„æ ¼å¼
      success: res => {
          // æ­¤å¤„åªèƒ½è·å–åˆ°å½“å‰ä½ç½®çš„ç»çº¬åº¦ï¼ˆåæ ‡ï¼‰
      },
    })
```
æ‰€ä»¥éœ€è¦åˆ©ç”¨è…¾è®¯åœ°å›¾Apiï¼Œé€šè¿‡åæ ‡ç‚¹åå‘è·å¾—è¯¥åœ°ç‚¹çš„è¯¦ç»†ä¿¡æ¯ã€‚
##### åŸºæœ¬é…ç½®
åœ¨app.jsonä¸­æ˜¯å¯¹æ•´ä¸ªå°ç¨‹åºçš„ä¸€äº›åŸºæœ¬é…ç½®
``` json
    {
    "pages": [
        "pages/index/index" // å½“å‰å°ç¨‹åºçš„ä¸»å…¥å£é¡µé¢
    ],
    // ä¸»çª—å£çš„ä¸€äº›é…ç½®ï¼Œå¦‚ä¸‹ï¼Œå¯¹èƒŒæ™¯é¢œè‰²å’Œå°ç¨‹åºé¡¶éƒ¨çš„å¯¼èˆªæ çš„æ ·å¼è¿›è¡Œäº†é…ç½®
    "window": {
        "backgroundColor": "#A7CAD3", 
        "backgroundTextStyle": "dark",
        "navigationBarBackgroundColor": "#A7CAD3",
        "navigationBarTitleText": "èœ—ç‰›å¤©æ°”",
        "navigationBarTextStyle": "black",
        "navigationStyle":"custom"
    },
    "permission": {
        "scope.userLocation": {
        "desc": "èœ—ç‰›å¤©æ°”å°è¯•è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯" // è¯¢é—®ç”¨æˆ·æ˜¯å¦å¯ä»¥å¾—åˆ°è·å–ä½ç½®æƒé™çš„æç¤ºæ–‡å­—
        }
    }
}
```
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥ä¸€æ­¥ä¸€æ­¥çš„å®ç°è¿™ä¸ªå°ç¨‹åºå§~~
## 1.ç•Œé¢

ç”±äºæ²¡æœ‰UIï¼Œå†åŠ ä¸Šç¬”è€…æ‰­æ›²çš„å®¡ç¾èƒ½åŠ›ï¼ˆååœ¨å±å¹•å‰å¼€å§‹æ„£ç¥ï¼Œé™·å…¥æ²‰æ€...ï¼‰,æ‰€ä»¥è¿˜æœ›å„ä½çœ‹å®˜å¤šå¿è€ç¬”è€…åˆæƒ³åˆå€Ÿé‰´çš„ç•Œé¢æˆæœ...çœ‹æ¥ä»¥åè¦å¤šåŠ å¼ºè¿™æ–¹é¢çš„èƒ½åŠ›(haha~)

å¥½äº†è¨€å½’æ­£ä¼ ï¼Œé¦–å…ˆï¼Œå‡†å¤‡ç”¨ä¸€ä¸ªé¡µé¢æ¥è§£å†³æˆ˜æ–—ï¼Œé‚£å°±æ˜¯å„ä½çœ‹åˆ°ä»¥ä¸Šçš„è¿™ä¸ªé¡µé¢(éƒ½è¯´äº†æ˜¯â€˜å°å¤©æ°”â€™å˜›)ï¼Œé¡µé¢ä¸€å…±åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ï¼Œå®æ—¶å¤©æ°”ã€24å°æ—¶å†…å¤©æ°”æƒ…å†µã€æœªæ¥ä¸€æ˜ŸæœŸå†…å¤©æ°”æƒ…å†µã€ä»Šå¤©æ—¥è½æ—¥å‡ºé£å‘é™é›¨ç­‰ç›¸å…³ä¿¡æ¯å’Œå¤©æ°”çš„ç”Ÿæ´»æŒ‡æ•°ï¼Œè¿™äº”ä¸ªéƒ¨åˆ†ç»„æˆäº†æ•´ä¸ªé¡µé¢ï¼Œå…¶å¯¹åº”çš„ç›¸åº”å¸ƒå±€è§ä¸€ä¸‹ä»£ç 
``` html
<view class="container" style='background: url({{bgImgUrl}}) center -200rpx / 100% no-repeat #62aadc;'>
    <view style='margin-top: -150rpx; padding-top: 150rpx;background: rgba(52,73,94, {{apl}})'>
      <view class='animation-view'>
      <!-- å½“å‰å®šä½ä¿¡æ¯æ˜¾ç¤º -->
        <view class='location' bind:tap="chooseLocation">
          <myicon class="icon" type="dingwei"></myicon>
          <text class='city'>{{position}}</text>
        </view>
        <!-- é€šè¿‡canvasç”»å‡ºå½“å‰å¤©æ°”æƒ…å†µåŠ¨ç”» -->
        <canvas canvas-id='animation' ></canvas>
        <!-- å®æ—¶å¤©æ°”æƒ…å†µ -->
        <view class="center-container">
        ...  
        </view>
        <!-- 24å°æ—¶å†…å¤©æ°”æƒ…å†µ -->
        <view class="all-day-list">
          <scroll-view class="scroll-view_x" scroll-x>
            <view class="all-day-list-item" wx:for="{{everyHourData}}" wx:key="item.time">
              <view class="day-list-item">{{item.time}}ç‚¹</view>
              <view class="day-list-item">
                <myicon type="{{item.iconType}}"></myicon>
              </view>
              <view class="day-list-item">{{item.tmp}}Â°</view>
            </view>
          </scroll-view>
        </view>
      </view>
        <!-- ä¸€æ˜ŸæœŸå†…å¤©æ°” -->
      <view class="one-week-list">
        <view class="one-week-list-item" wx:for="{{everyWeekData}}" wx:key="item.weekday">
          <view class="week-list-item">
            <view>{{item.weekday}}</view>
            <view>{{item.date}}</view>
          </view>
          <view class="week-list-item">{{item.cond_txt_d}}</view>
          <view class="week-list-item">
            <myicon type="{{item.iconTypeBai}}"></myicon>
          </view>
          <view class="week-list-item">{{item.tmp_min}}~{{item.tmp_max}}Â°</view>
          <view class="week-list-item">
            <myicon type="{{item.iconTypeYe}}"></myicon>
          </view>
          <view class="week-list-item">{{item.cond_txt_n}}</view>
          <view class="week-list-item" style="font-size: 28rpx">
            <view>{{item.wind_dir == 'æ— æŒç»­é£å‘' ? 'æ— ' : item.wind_dir}}</view>
            <view>{{item.wind_sc}}çº§</view>
          </view>
        </view>

      </view>
        <!-- æ—¥å‡ºæ—¥è½é£å‘é™é›¨æ¦‚ç‡ç­‰ -->
      <view class='live-index-view'>
        ...
      </view>
        <!-- ç”Ÿæ´»æŒ‡æ•° -->
      <view class='last-view'>
        <view class='last-view-item' wx:for="{{lifeStyle}}" wx:key="item.type">
          <view class='last-view-item-top'>{{lifeEnum[item.type]}}</view>
          <view class='last-view-item-bottom'>{{item.brf}}</view>
        </view>
      </view>
    </view>
</view>

```
å…·ä½“ **css** æ ·å¼ï¼Œè¯¦è§ [èœ—ç‰›å°å¤©æ°”](https://github.com/liuchengying/wxWeather) æºç 

> æ³¨æ„ï¼š(ç¬”è€…å…¥å‘ï¼Œä¸€å¼€å§‹ä½¿ç”¨çš„çºµå‘çš„scroll-viewï¼Œåæ¥æ— å¥ˆçš„ç”¨äº†åŸæ¥é¡µé¢çš„æ»šåŠ¨)
> **scroll-view:** *å…·ä½“å±æ€§å‚è€ƒå°ç¨‹åºå®˜æ–¹æ–‡æ¡£*
> åœ¨å°ç¨‹åºä¸­ï¼Œå†…éƒ¨ä¸ºæˆ‘ä»¬æä¾›äº†scroll-viewè¿™ä¸ªé¡µé¢æ»šåŠ¨çš„ç»„ä»¶ï¼Œå¯¹æ€§èƒ½è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„ä½¿ç”¨ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¹Ÿä¼šæœ‰ä¸€äº›å°å‘
> * åœ¨ä½¿ç”¨scroll-viewæ˜¯ï¼Œå¦‚æœæ˜¯çºµå‘ï¼ˆYè½´ï¼‰æ»šåŠ¨ï¼Œscroll-yå±æ€§ï¼Œåˆ™å¿…é¡»ä¸ºæ­¤scroll-viewè®¾ç½®ä¸€ä¸ªå›ºå®š(æ˜ç¡®)çš„é«˜
> * è¯·å‹¿åœ¨scroll-viewç»„ä»¶æ ‡ç­¾å†…ä½¿ç”¨ textareaã€mapã€canvasã€videoç­‰ç»„ä»¶
> * åœ¨ä½¿ç”¨äº†scroll-viewç»„ä»¶æ—¶ä¼šé˜»æ­¢é¡µé¢çš„å›å¼¹æ•ˆæœï¼Œä¹Ÿå°±æ˜¯åœ¨scroll-viewä¸­æ»šåŠ¨ï¼Œæ— æ³•è§¦å‘onPullDownRefreshæ–¹æ³•
> * å¦‚æœæƒ³ä½¿ç”¨åŸç”Ÿçš„ä¸‹æ‹‰åˆ·æ–°ï¼ˆéè‡ªå®šä¹‰ï¼‰æˆ–è€…åŒå‡»é¡¶éƒ¨é¡µé¢å›æ»šåˆ°é¡µé¢é¡¶éƒ¨ï¼Œè¯·ä¸è¦ä½¿ç”¨scroll-viewã€‚

ç›¸ä¿¡å„ä½çœ‹å®˜å‘ç°äº†ä»¥ä¸Šä»£ç ä¸­æœ‰ä¸€ä¸ª\<myicon> çš„æ ‡ç­¾ï¼Œæ­¤æ ‡ç­¾ä¸ºä¸€ä¸ªå›¾æ ‡ç»„ä»¶ï¼Œå› ä¸ºèœ—ç‰›å¤©æ°”ä¸­ç”¨åˆ°çš„å›¾æ ‡ä¹Ÿæ¯”è¾ƒå¤šã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¯´æ˜ä¸‹æœ‰å…³ç»„ä»¶çš„å°è£…äº‹å®œã€‚ä¸ºäº†æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œæ˜“ç»´æŠ¤æ€§ï¼Œä»¥åŠå¤šäººåˆä½œå¼€å‘çš„æ•ˆç‡ï¼Œç»„ä»¶åŒ–ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³åŠæ³•ï¼Œåœ¨å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œæ¯ä¸ªé¡µé¢ç”±å››ä¸ªæ–‡ä»¶ç»„æˆ
* *.wxml    ----æ–‡æ¡£ç»“æ„ => ç­‰åŒäºhtml
* *.js     ----å¤„ç†ä¸šåŠ¡é€»è¾‘
* *.json    ----å½“å‰é¡µé¢æˆ–ç»„ä»¶çš„ä¸€äº›é…ç½®å’Œé€‰é¡¹
* *.wxss    ----æ ·å¼æ–‡ä»¶ => ç­‰åŒäºcss

è€Œå¯¹äºæœ¬å°ç¨‹åºä¸­\<myicon>ç»„ä»¶æ¥è¯´
``` html
<!-- ä»…æœ‰ä¸€ä¸ªtextæ ‡ç­¾ï¼Œé€šè¿‡typeå±æ€§æ¥æ”¹å˜å­—ç¬¦å›¾æ ‡çš„ç±»å‹ï¼ˆå¤šäº‘ï¼Œå°é›¨...ï¼‰ -->
<!-- å­—ç¬¦å›¾æ ‡é€šè¿‡cssæ ·å¼å’Œè‡ªå®šä¹‰å­—ä½“æ¥å®ç°ï¼Œé€šè¿‡classæ¥æ˜¾ç¤ºä¸åŒç±»å‹çš„å›¾æ ‡å­—ä½“ -->
<!-- å…·ä½“è‡ªå®šä¹‰å­—ä½“å›¾æ ‡åˆ¶ä½œè¿‡ç¨‹å¯å‚è€ƒæ­¤é“¾æ¥ https://blog.csdn.net/thatway_wp/article/details/79076023 -->
<text class="icon icon-{{type}}"></text>
```
``` javascript
// å°ç¨‹åºä¸­çš„ç»„ä»¶ï¼Œé€šè¿‡è°ƒç”¨Componentæ–¹æ³•ï¼Œå°†ç»„ä»¶çš„é€»è¾‘å¤„ç†éƒ¨åˆ†ï¼Œå±æ€§ä»¥åŠæ–¹æ³•ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰ç­‰ä¸€å¯¹è±¡çš„æ–¹å¼ä¼ å…¥Componentæ–¹æ³•ä¸­
Component({
    properties: {
      type: {
        type: String, // typeå±æ€§çš„ç±»å‹
        value: '' // é»˜è®¤å€¼
      }
    }
  });
```
ä½¿ç”¨äº†Componentæ„é€ å™¨ï¼Œé€šè¿‡å‚æ•°æŒ‡å®šç»„ä»¶çš„å±æ€§ï¼Œæ•°æ®ï¼Œæ–¹æ³•ä»¥åŠç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œåœ¨æ­¤ç»„ä»¶ä¸­å®šä¹‰äº†æ¥å—çš„typeå±æ€§ï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œå…¶é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚
``` json
{
    "component": true // é…ç½®ï¼Œå½“å‰ä¸ºç»„ä»¶
}
```
``` javascript
// CSS éƒ¨åˆ†ç•¥è¿‡...
```
å°±è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„iconå›¾æ ‡ç»„ä»¶å°±å°è£…å¥½äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•å•Šã€‚å°è£…æ˜¯å°è£…å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè°ƒç”¨è¿™ä¸ªç»„ä»¶å‘¢ï¼Œæ˜¯ä¸æ˜¯å¾ˆç±»ä¼¼äºVueå‘¢ï¼Œæ²¡é”™ï¼Œåªéœ€è¦åœ¨ä½ è°ƒç”¨çš„é¡µé¢ä¸­æ³¨å†Œä¸€ä¸‹å³å¯
``` json
// å½“å‰æƒ³è¦è°ƒç”¨çš„é¡µé¢çš„*.jsonæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹
{
  "enablePullDownRefresh": true, // æ­¤é¡¹ä¸ç»„ä»¶æ— å…³ï¼Œæ­¤é¡¹ä¸ºæ˜¯å¦ç”¨å°ç¨‹åºæœ¬èº«çš„ä¸‹æ‹‰åˆ·æ–°åŠŸèƒ½
  "usingComponents": {
    "myicon": "../../components/icon/index" // è°ƒç”¨ï¼Œæ³¨å†Œiconç»„ä»¶
  }
}
```

## 2.ç›¸å…³æ•°æ®API
ä¸€å¼€å§‹å°±è¯´åˆ°äº†éœ€è¦ä½¿ç”¨**è…¾è®¯åœ°å›¾**APIçš„appkeyè¿˜æœ‰**å’Œé£å¤©æ°”**APIçš„appkeyï¼Œç¬”è€…æ˜¯å°†appkeyé…ç½®åœ¨äº†config.jsä¸­ï¼Œçœ‹å®˜åªéœ€å°†è‡ªå·±ç›¸åº”çš„appkeyå€¼æ›¿æ¢å³å¯ï¼Œç”±äºappkeyæ˜¯ç§å¯†çš„ï¼Œæ­¤å¤„å°±ä¸å…¬å¼€äº†ï¼Œè¿˜æœ›è°…è§£ã€‚
``` javascript
// config.js
export default {
    MAP_API_KEY: 'XXXXX-XXXXX-XXXXX-XXXXX-XXXXX-XXXXX', // è…¾è®¯åœ°å›¾key
    WEATHER_API_KEY: 'XXXXXXXXXXXXXXXX' // å’Œé£å¤©æ°”key
}
```
æ‰€æœ‰æ•°æ®çš„æ¥å£ï¼Œéƒ½å®šä¹‰åœ¨äº†api.jsæ–‡ä»¶ä¸­ï¼Œæ­¤å¤„æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œçœ‹å®˜è‡ªè¡Œé€šè¿‡æ¥å£æ–‡æ¡£æŸ¥è¯¢ã€‚æ¥å£å‡é‡‡ç”¨å›è°ƒçš„æ–¹å¼ï¼Œç¬”è€…å¹¶æ²¡æœ‰å°è£…æˆPromiseçš„æ–¹å¼ï¼Œå¦‚æœæœ‰å…´è¶£å¯è‡ªè¡Œæ›´æ”¹ã€‚
``` javascript
// å¼•å…¥configï¼Œä¸ºäº†åé¢çš„key
import config from '../uitl/config'
// åœ°å›¾key
const mapKey = config.MAP_API_KEY
// å’Œé£å¤©æ°”key
const weatherKey = config.WEATHER_API_KEY
// map url
const locationUrl = 'https://apis.map.qq.com/ws/geocoder/v1/'
//å¤©æ°”url
const weatherUrl = 'https://free-api.heweather.net/s6/weather/forecast'
//24å°æ—¶å†… æ¯å°æ—¶
const everyhoursUrl = 'https://api.heweather.net/s6/weather/hourly'
// ä¸€å‘¨å†…
const everyWeekUrl = 'https://api.heweather.net/s6/weather/forecast'
//ç©ºæ°”è´¨é‡
const airQualityUrl = 'https://api.heweather.net/s6/air/now'
// å®å†µå¤©æ°”
const weatherLive = 'https://api.heweather.net/s6/weather/now'
// ç”Ÿæ´»æŒ‡æ•°
const lifeStyle = 'https://api.heweather.net/s6/weather/lifestyle'
// æ ¹æ®å½“å‰ä½ç½®çš„åæ ‡åå¾—åˆ°å½“å‰ä½ç½®çš„è¯¦ç»†ä¿¡æ¯
// lat,lon ä¸ºç»çº¬åº¦åæ ‡
export const getPosition = (lat, lon, success = {}, fail = {}) => {
  return wx.request({
    url: locationUrl,
    header: {
      'Content-Type': 'application/json'
    },
    data: {
      location: `${lat},${lon}`,
      key: mapKey,
      get_poi: 0
    },
    success,
    fail
  })
}
// æ ¹æ®locationå¾—åˆ°å¤©æ°”ä¿¡æ¯
// lat,lon ä¸ºç»çº¬åº¦åæ ‡
export const getWeaterInfo = (lat, lon, success = {}, fail = {}) => {
  return wx.request({
    url: weatherUrl,
    header: {
      'Content-Type': 'application/json'
    },
    data: {
      location: `${lat},${lon}`,
      lang: 'zh',
      unit: 'm',
      key: weatherKey
    },
    success,
    fail
  })
}
// æ ¹æ®locationä¿¡æ¯å¾—åˆ°24å°é€å°æ—¶å¤©æ°”æƒ…å†µ
// lat,lon ä¸ºç»çº¬åº¦åæ ‡
export const getEveryHoursWeather = (lat, lon, success = {}, fail = {}) => {
  return wx.request({
    url: everyhoursUrl,
    header: {
      'Content-Type': 'application/json'
    },
    data: {
      location: `${lat},${lon}`,
      lang: 'zh',
      unit: 'm',
      key: weatherKey
    },
    success,
    fail
  })
}
...
... // å…¶ä»–æ¥å£ç±»ä¼¼
...
}
```
## 3.å®ç°é€»è¾‘(ä¸šåŠ¡ä»£ç )
#### 3.1 æµç¨‹
é¦–å…ˆï¼Œå½“åˆæ¬¡åŠ è½½é¡µé¢æ—¶ï¼Œå¤§ä½“æµç¨‹ä¸ºé¦–å…ˆé€šè¿‡å®šä½è·å–ä½ç½®ï¼Œç„¶åé€šè¿‡ä½ç½®ä¿¡æ¯å»å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æ¯ä¸€é¡¹å¤©æ°”ä¿¡æ¯ï¼Œæœ€åå°†å¤©æ°”ä¿¡æ¯æ¸²æŸ“åé¡µé¢ä¸­ç›¸åº”çš„ä½ç½®
**å…·ä½“æµç¨‹**ï¼š
* è·å–ä½ç½®ç»çº¬åº¦
* é€šè¿‡ç»çº¬åº¦é€†å‘è·å¾—ä½ç½®ä¿¡æ¯
* é€šè¿‡ä½ç½®ä¿¡æ¯è·å–å¤©æ°”ä¿¡æ¯
    * è·å–å®æ—¶å¤©æ°”ä¿¡æ¯
        * **åˆ¤æ–­æ˜¯å¦ä¸ºç™½å¤©å’Œæ™šä¸Šï¼ˆæ”¹å˜é¡µé¢èƒŒæ™¯ï¼‰--è¯¥å°ç¨‹åºä¸­å®šä¹‰æ—©ä¸Š6ç‚¹åˆ°æ™šä¸Š18ç‚¹ä¸ºæµ…è‰²èƒŒæ™¯ï¼Œå…¶ä»–æ—¶é—´ä¸ºæ·±è‰²èƒŒæ™¯**
        * **åˆ¤æ–­å½“å‰å¤©æ°”çš„æƒ…å†µ(é›¨æˆ–é›ªçš„å¤§å°),åœ¨å®å†µå¤©æ°”ç•Œé¢ä¸­é€šè¿‡canvasæ¨¡æ‹Ÿé›¨é›ªçš„åŠ¨ç”»**
    * è·å–24å°æ—¶å¤©æ°”ä¿¡æ¯
    * è·å–ä¸€æ˜ŸæœŸçš„å¤©æ°”ä¿¡æ¯
    * è·å–ç”Ÿæ´»æŒ‡æ•°ä¿¡æ¯
> å½“é€šè¿‡æ‰‹åŠ¨æ”¹å˜ä½ç½®ä¿¡æ¯æ—¶ï¼ŒæŒ‰é¡ºåºé‡å¤æ‰§è¡Œä»¥ä¸Šæ­¥éª¤
#### 3.2 è·å–ç»çº¬åº¦ä»¥åŠé€†å‘å‡ºä½ç½®ä¿¡æ¯
é€šè¿‡wx.getLocationåŸç”Ÿæ–¹æ³•è·å–ç»çº¬åº¦ä¿¡æ¯ï¼Œåœ¨ç»è¿‡è…¾è®¯åœ°å›¾apié€šè¿‡ç»çº¬åº¦é€†å‘è·å–åˆ°ç›¸åº”çš„ä½ç½®ä¿¡æ¯ï¼Œå¯¹äºè¿™ä¸ªé¡¹ç›®æ¥è¯´è·å–ä½ç½®ä¿¡æ¯æ˜¯æœ€é‡è¦çš„ä¿¡æ¯ï¼Œæ•…æˆ‘ä»¬å¸Œæœ›åœ¨é¡µé¢ä¸€åŠ è½½çš„æ—¶å€™å°±æ‰§è¡Œæ–¹æ³•è·å–ï¼Œç„¶åã€onLoadã€æ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½ï¼Œæ­¤æ–¹æ³•ä¼šåœ¨é¡µé¢åˆšåŠ è½½çš„æ—¶å€™ï¼ˆdocumentæ–‡æ¡£ç»“æ„æ¸²æŸ“å®Œæˆåï¼‰æ‰§è¡Œã€‚
> å°ç¨‹åºé¡µé¢ï¼ˆPageï¼‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š

|   name   | type  |      functional      |
| :------: | :---: | :------------------: |
|  onLoad  | å‡½æ•°  |     ç›‘å¬é¡µé¢åŠ è½½     |
| onReady  | å‡½æ•°  | ç›‘å¬é¡µé¢åˆæ¬¡æ¸²æŸ“å®Œæˆ |
|  onShow  | å‡½æ•°  |     ç›‘å¬é¡µé¢æ˜¾ç¤º     |
|  onHide  | å‡½æ•°  |     ç›‘å¬é¡µé¢éšè—     |
| onUnload | å‡½æ•°  |     ç›‘å¬é¡µé¢å¸è½½     |

ä»¥ä¸‹ä¸ºè·å–ä½ç½®ä¿¡æ¯ä»£ç ï¼š
``` javascript
    // onLoad
    onLoad: function () {
        ...
        ...
        this.getPositon() // è°ƒç”¨è·å–ä½ç½®ä¿¡æ¯
    }
    // åŸç”Ÿæ–¹æ³•è·å–ç»çº¬åº¦ä¿¡æ¯
    getPosition: function () {
        wx.getLocation({
            type: 'gcj02',
            success: this.updateLocation, // æˆåŠŸä¼šæ‰  updataLocation æ–¹æ³•ä¸ºæ›´æ–°ä½ç½®
            fail: err => {
                console.log(err)
            }
        })
    }
    // æ›´æ–°ä½ç½®ä¿¡æ¯
    updateLocation: function(res) {
        ...
        ...
        let {latitude: x,longitude: y,name} = res;
        let data = {
            location: {
                x,
                y,
                name: name || 'åŒ—äº¬å¸‚'
            },
            ...
            ...
        };
        this.setData(data); // è®¾ç½®pageä¸­dataå¯¹è±¡ä¸­çš„å±æ€§
        // é€šè¿‡ç»çº¬åº¦é€†å‘è·å¾—ä½ç½®ä¿¡æ¯
        this.getLocation(x, y, name);
  }
  // é€†å‘è·å–ä½ç½®ä¿¡æ¯
  getLocation: function(lat, lon, name) {
    wx.showLoading({
      title: "å®šä½ä¸­",
      mask: true
    })
    // è…¾è®¯åœ°å›¾apiæ¥å£
    getPosition(lat, lon, (res) => {
        if (res.statusCode == 200) {
            let response = res.data.result
            let addr = response.formatted_addresses.recommend || response.rough
            this.setData({
                position: addr // èµ‹å€¼ç»™ dataå¯¹è±¡ä¸­çš„ç›¸åº”å±æ€§
            })
            wx.hideLoading()
            this.getData(lat, lon);
        }
        }, (err => {
        console.log(err)
        wx.hideLoading()
        }))
  },
    // å½“ç”¨æˆ·ç‚¹å‡»æ˜¾ç¤ºå®šä½å¤„çš„viewæ—¶ï¼Œä¼šè°ƒç”¨åŸç”Ÿçš„chooseLocationæ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨é€‰æ‹©ä½ç½®é¡µé¢
    chooseLocation: function() {
        wx.chooseLocation({
            success: res => {
                let {latitude,longitude} = res
                let {x,y} = this.data.location
                if (latitude == x && longitude == y) {

                } else {
                    this.updateLocation(res)
                }
            }
        })
    },
```
##### setDataæ–¹æ³•
ä¸Šé¢ä»£ç ä¸­ä¸¤æ¬¡ç”¨åˆ°äº†setDataæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„å±æ€§ä¸ºéœ€è¦æ”¹å˜çš„æ•°æ®ï¼ŒåŒæ—¶æ¥å—ä¸€ä¸ªcallbackå‡½æ•°ï¼Œç”¨äºé€šè¿‡æ”¹å˜æ•°æ®æ›´æ–°é¡µé¢æ¸²æŸ“å®Œæˆä¹‹åçš„å›è°ƒã€‚æˆ‘ä»¬æ¥çœ‹çœ‹dataçš„ä½œç”¨ã€‚
``` javascript
    page({
        data: {
            backgroundColorï¼š'red',
            fontSize: '20',
            ...
            ...
        }
    })
```
åœ¨pageä¸­ï¼Œdataä¸­çš„å±æ€§æ˜¯è¿æ¥**é€»è¾‘å±‚**å’Œ**è§†å›¾å±‚**çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡jsä»£ç çš„é€»è¾‘æ¥æ§åˆ¶dataä¸­çš„å±æ€§çš„å€¼ï¼Œè€Œé¡µé¢ä¸­çš„ä¸€éƒ¨åˆ†æ˜¾ç¤ºå†…å®¹æ˜¯æ ¹æ®dataä¸­çš„å±æ€§çš„å€¼è€Œå˜åŒ–ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„mvvmæ¨¡å‹ï¼Œæˆ‘ä»¬åªéœ€æŠŠé‡å¿ƒæ”¾åœ¨jsé€»è¾‘å±‚ï¼Œè€Œæ— éœ€å»é¢‘ç¹çš„æ‰‹åŠ¨çš„æ“ä½œè§†å›¾å±‚ã€‚äº†è§£äº†dataçš„ä½œç”¨ï¼Œå†æ¥è¯´setDataï¼ŒsetDataå°±æ˜¯åœ¨jsé€»è¾‘å±‚ä¸­å»æ”¹å˜å’Œè®¾ç½®dataä¸­çš„å±æ€§çš„å€¼ï¼Œä»è€Œä½¿é¡µé¢å¾—åˆ°å“åº”ã€‚
``` javascript
    ...
    this.setData({
        backgroundColor: 'green' // æ”¹å˜èƒŒæ™¯é¢œè‰²å±æ€§ï¼Œè§†å›¾ä¸­ä»¥æ¥æ­¤å±æ€§çš„ä¼šå°†é¢œè‰²å˜æˆç»¿è‰²
    })
    ...
```
> æ³¨æ„ï¼š
> * ç›´æ¥ä¿®æ”¹this.dataçš„å€¼ï¼Œè€Œä¸æ˜¯é€šè¿‡è°ƒç”¨this.setData()æ–¹æ³•ï¼Œæ˜¯æ— æ³•æˆåŠŸæ”¹å˜é¡µé¢çš„çŠ¶æ€çš„
> * ä»…ä»…æ”¯æŒJSONåŒ–çš„æ•°æ®ï¼ˆkeyï¼švalueï¼‰
> * å•è¯è®¾ç½®çš„å€¼ä¸èƒ½è¶…è¿‡1024Kï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™å°½é‡ä¸è¦ä¸€æ¬¡è®¾ç½®è¿‡å¤šçš„æ•°æ®
> * ä¸è¦æŠŠdataä¸­çš„ä»»ä½•ä¸€é¡¹valueå€¼è®¾ç½®æˆundefinedï¼Œå¦åˆ™è¿™ä¸€é¡¹å°†ä¸èƒ½è¢«è®¾ç½®ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰å…¶ä»–é—®é¢˜
> * ä¸è¦é¢‘ç¹çš„å»è°ƒç”¨this.setData()æ–¹æ³•å»è®¾ç½®åŒä¸€ä¸ªå€¼æˆ–è€…å¤šä¸ªå€¼ï¼Œæ¯”å¦‚é€šè¿‡åœ¨å¾ªç¯ä¸­è°ƒç”¨this.setData(),è¿™æ ·ä¼šå¯¼è‡´æ€§èƒ½æŸè€—

#### 3.3 è·å–å¤©æ°”
é€šè¿‡ä¸Šé¢è·å¾—åˆ°çš„ä½ç½®ä¿¡æ¯ï¼Œç”¨æ¥è°ƒç”¨ç›¸åº”çš„æ¥å£è·å¾—å½“å‰ä½ç½®çš„å¤©æ°”ã€‚æ–¹æ³•æ¥å£å·²åœ¨å‰é¢å°è£…å¥½ï¼Œç›´æ¥è°ƒç”¨ç„¶åé€šè¿‡å¯¹responseè¿›è¡Œè¿‡æ»¤æˆ–è€…é‡ç»„ç­‰æ¥æ»¡è¶³å½“å‰çš„åº”ç”¨ï¼Œæœ€åé€šè¿‡this.setData()æ–¹æ³•å»æ›´æ–°æ•°æ®æ˜¯é¡µé¢å¾—åˆ°å“åº”ã€‚
> * getWeather(lat, lon) // lat, lon ä¸ºå½“å‰ä½ç½®çš„ç»çº¬åº¦
> * getAir(lat, lon)
> * getHourWeather(lat, lon)
> * getWeatherForWeek(lat, lon)
> * getLifeIndex(lat, lon)

*ä»¥ä¸Šæ–¹æ³•ä¸åœ¨ä¸€ä¸€åˆ—ä¸¾å…¶ä¸­æ•°æ®å¤„ç†çš„è¿‡ç¨‹ï¼Œå¯è‡ªè¡ŒæŸ¥çœ‹æºç  è¯¦è§ [èœ—ç‰›å°å¤©æ°”](https://github.com/liuchengying/wxWeather) æºç *

##### å…³äºcanvasç”»å‡ºæ¨¡æ‹Ÿé›¨å’Œé›ªçš„ç²’å­åŠ¨ç”»æ•ˆæœ
ç²’å­åŠ¨ç”»åœ¨ç°åœ¨è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®ä¸­è¢«ç”¨åˆ°ã€‚ä»é™æ€åˆ°åŠ¨æ€æœ€åå†åˆ°ä»¿çœŸæ•ˆæœæ›´å¥½çš„è§†è§‰ä½“éªŒï¼Œä¹Ÿæ˜¯äººä»¬åœ¨è§†è§‰ä¸Šè¿½æ±‚æè‡´çš„ä½“éªŒã€‚æˆ‘ä»¬é€šè¿‡ç²’å­ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ç‚¹å’Œçº¿ï¼Œæ¥æ¨¡æ‹Ÿå‡ºé›¨å’Œé›ªçš„æ•ˆæœã€‚é€šè¿‡å°ç¨‹åºä¸­çš„canvasç”»å¸ƒæ¥ç”»å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚
å®ç°åŸç†ï¼š
* é¦–å…ˆæˆ‘ä»¬é€šè¿‡ç‚¹å’Œçº¿æ¥æ¨¡æ‹Ÿé›¨æ»´ä¸‹è½å’Œé›ªèŠ±é£˜è½
* æˆ‘ä»¬é€šè¿‡åœ¨åŒä¸€æ—¶é—´åŒä¸€å—åŒºåŸŸ(ä¹Ÿå°±æ˜¯æ­¤å°ç¨‹åºé¡µé¢ä¸­å®å†µå¤©æ°”çš„åŒºåŸŸ)ä¸­é›¨æ»´æˆ–é›ªèŠ±çš„å¤šå°‘æ¥è¡¨ç¤ºå¤§å°
* æ„é€ ä¸€ä¸ªæ€»çš„WeatheråŸºç±»ï¼Œæ¥è®¾ç½®ç”»å¸ƒçš„widthï¼Œheightï¼Œä»¥åŠé›¨æ»´æˆ–é›ªèŠ±çš„æ•°é‡ï¼ŒåŒæ—¶ä¼šæœ‰ä¸¤ä¸ªStartå’ŒStopæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å¼€å§‹å’Œåœæ­¢æ–¹æ³•ï¼‰
* æ„é€ ä¸€ä¸ªRainç±»å’Œä¸€ä¸ªSnowç±»ï¼Œéƒ½ç»§æ‰¿è‡ªWeatherç±»ï¼ŒRainå’ŒSnowéƒ½æœ‰è‡ªå·±ç§æœ‰çš„ _init(åˆå§‹åŒ–), _drawingï¼ˆç”»ï¼‰, _updateï¼ˆæ›´æ–°ç”»å¸ƒï¼‰ä¸‰ä¸ªæ–¹æ³•æ¥æ§åˆ¶Rainå’ŒSnowçš„åŠ¨ä½œ

#### Weatherç±»
Weatherç±»æ˜¯ä¸€ä¸ªåŸºç±»ï¼Œä¸»è¦å¤„ç†ç”»å¸ƒçš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚widthï¼Œheightï¼Œå®šæ—¶å™¨ï¼Œä»¥åŠå½“å‰åŠ¨ç”»çš„çŠ¶æ€ï¼ˆstatusï¼‰ç­‰
``` javascript
    const STOP_ANIMATION = 'stop'
    const START_ANIMATION = 'start'

    class Weather {
        constructor(context, width, height, option = {}) {
            this.opt = option || {}
            this.context = context
            this.timer = null
            this.status = STOP_ANIMATION
            this.width = width
            this.height = height
            this._init()
        }
        // å®ä¾‹è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¼€å§‹åœ¨ç”»å¸ƒä¸Šç”»
        start() {
            if(this.status !== START_ANIMATION) {
                this.status = START_ANIMATION
                this.timer = setInterval(() => {
                    this._drawing()
                }, 30)
            return this
            }
        }
        stop() {
            this.status = STOP_ANIMATION
            clearInterval(this.timer)
            this.timer = null
            return this
        }
    }

    export default Weather
```
#### Rainç±»
Rainç±»ç»§æ‰¿è‡ªWeatherç±»ï¼Œé€šè¿‡_initæ–¹æ³•å’Œçˆ¶ç±»ä¸­ç”»å¸ƒå‚æ•°ï¼Œä»¥åŠoptionå‚æ•°ä¸­çš„counts(é›¨æ»´æ•°é‡)æ¥åˆå§‹åŒ–ã€‚
``` javascript
import Weather from './Weather.js'
class Rain extends Weather {
    // åˆå§‹åŒ–
  _init() {
    this.context.setLineWidth(2)
    this.context.setLineCap('round')
    let height = this.height
    let width = this.width
    let counts = this.opt.counts || 100
    let speedCoefficient = this.opt.speedCoefficient
    let speed = speedCoefficient * height
    this.animationArray = []
    let arr = this.animationArray

    for (let i = 0; i < counts; i++) {
      let d = {
        x: Math.random() * width,
        y: Math.random() * height,
        len: 2 * Math.random(),
        xs: -1,
        ys: 10 * Math.random() + speed,
        color: 'rgba(255,255,255,0.1)'
      }
      arr.push(d)
    }
  }
 // å¼€å§‹ç”»
  _drawing() {
    let arr = this.animationArray
    let ctx = this.context
    ctx.clearRect(0, 0, this.width, this.height)
    for (let i = 0; i < arr.length; i++) {
      let s = arr[i]
      ctx.beginPath()
      ctx.moveTo(s.x, s.y)
      ctx.lineTo(s.x + s.len * s.xs, s.y + s.len * s.ys)
      ctx.setStrokeStyle(s.color)
      ctx.stroke()
    }
    ctx.draw()
    return this.update()
  }
// æ›´æ–°ç”»å¸ƒ
  update() {
    let width = this.width
    let height = this.height
    let arr = this.animationArray
    for (let i = 0; i < arr.length; i++) {
      let s = arr[i]
      s.x = s.x + s.xs
      s.y = s.y + s.ys
      if (s.x > width || s.y > height) {
        s.x = Math.random() * width
        s.y = -10
      }
    }
  }
}

export default Rain
```
#### Snowç±»
Snowç±»ç»§æ‰¿è‡ªWeatherç±»ï¼Œé€šè¿‡_initæ–¹æ³•å’Œçˆ¶ç±»ä¸­ç”»å¸ƒå‚æ•°ï¼Œä»¥åŠoptionå‚æ•°ä¸­çš„counts(é›ªèŠ±æ•°é‡)æ¥åˆå§‹åŒ–ã€‚
``` javascript
import Weather from './Weather.js'
class Snow extends Weather {
    // åˆå§‹åŒ–
  _init() {
    let {
      width,
      height
    } = this
    console.log(width)
    let colors = this.opt.colors || ['#ccc', '#eee', '#fff', '#ddd']
    let counts = this.opt.counts || 100

    let speedCoefficient = this.opt.speedCoefficient || 0.03
    let speed = speedCoefficient * height * 0.15

    let radius = this.opt.radius || 2
    this.animationArray = []
    let arr = this.animationArray

    for (let i = 0; i < counts; i++) {
      arr.push({
        x: Math.random() * width,
        y: Math.random() * height,
        ox: Math.random() * width,
        ys: Math.random() + speed,
        r: Math.floor(Math.random() * (radius + 0.5) + 0.5),
        color: colors[Math.floor(Math.random() * colors.length)],
        rs: Math.random() * 80
      })
    }
    console.log(arr)
  }
  // å¼€å§‹ç”»
  _drawing() {
    let arr = this.animationArray
    let context = this.context
    context.clearRect(0, 0, this.width, this.height)
    for (let i = 0; i < arr.length; i++) {
      let {
        x,
        y,
        r,
        color
      } = arr[i]
      context.beginPath()
      context.arc(x, y, r, 0, Math.PI * 2, false)
      context.setFillStyle(color)
      context.fill()
      context.closePath()
    }

    context.draw()
    this._update()
  }
  // æ›´æ–°ç”»å¸ƒ
  _update() {
    let {
      width,
      height
    } = this
    let arr = this.animationArray
    let v = this.opt.speedCoefficient / 10
    for (let i = 0; i < arr.length; i++) {
      let p = arr[i]
      let {
        ox,
        ys
      } = p
      p.rs += v
      p.x = ox + Math.cos(p.rs) * width / 2
      p.y += ys
      if (p.x > width || p.y > height) {
        p.x = Math.random() * width
        p.y = -10
      }
    }
  }
}

export default Snow
```

ç»“æŸï¼ï¼ï¼

------------------------------
åˆ°æ­¤ï¼Œèœ—ç‰›å°å¤©æ°”å°±å¼€å‘å®Œæˆäº†ï¼Œå¸Œæœ›å¯¹å„ä½æœ‰å¸®åŠ©ã€‚
å¸Œæœ›åœ¨é˜…è¯»çš„åŒæ—¶å¦‚æœæ„Ÿè§‰å¯¹å„ä½æœ‰å¸®åŠ©ï¼Œè¿˜è¯·çœ‹å®˜åˆ«å¿˜äº†ç»™ä½ å¤§å¤§çš„èµğŸ‘ï¼Œç å­—ä¸æ˜“...
åˆæ¥ä¹åˆ°ï¼Œèƒ½è€æœ‰é™ï¼Œæ°´å¹³ä¸€èˆ¬ï¼Œåªæ˜¯æƒ³ç€ç”¨æ–‡å­—æ¥è®°å½•å’Œä¼ é€’ä¸€äº›èƒ½é‡ã€‚å¦‚æœæ–‡ä¸­æœ‰é”™è¯¯ä¹‹å¤„ï¼Œè¿˜è¯·å„ä½å¤šå¤šææ„è§ï¼Œå…±åŒæ¢è®¨ï¼Œä¹Ÿè¯·å„ä½å¤šåŒ…æ¶µã€‚
